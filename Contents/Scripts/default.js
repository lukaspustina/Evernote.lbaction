var Evernote,SETTINGS,SETTINGS_FILE,createNote,editSettings,favorites,handleSearchResult,init,loadSettings,log,mapFavorites,mapSavedSearch,mapSearchResults,openNote,run,runWithString,saved_searches,syncNow;SETTINGS_FILE="",SETTINGS=[],run=function(e){return log("run: '"+e+"'"),Evernote.open(),log("run: '"+e+"' done.")},runWithString=function(e){var t,n;return log("runWithString: '"+e+"'"),log(JSON.stringify(e)),e.length>=SETTINGS.query_min_len?(n=Evernote.search(e,SETTINGS.max_results,SETTINGS.debug),mapSearchResults(n,e)):(t=[{title:"Create new Note",action:"createNote",icon:"com.evernote.Evernote"},{title:"Synchronize now",action:"syncNow",icon:"sync.png"},{title:"Edit Settings",action:"editSettings",actionArgument:SETTINGS_FILE,icon:"settings.png"}],SETTINGS.saved_searches.length>0&&t.unshift({title:"Saved Searches",action:"saved_searches",actionReturnsItems:!0,icon:"search.png"}),SETTINGS.favorites.length>0&&t.unshift({title:"Favorite Notes",action:"favorites",actionReturnsItems:!0,icon:"favorite.png"}),t)},handleSearchResult=function(e){return LaunchBar.options.commandKey&&LaunchBar.options.shiftKey?Evernote.open_search_window(e.query):LaunchBar.options.commandKey?Evernote.copy_note_link(e):Evernote.open_note(e)},openNote=function(e){return Evernote.open_note(e)},createNote=function(){return Evernote.createNote()},syncNow=function(){return Evernote.syncNow()},editSettings=function(e){var t;return t=Action.path+"/Contents/Scripts/default_settings.js",File.exists(e)||LaunchBar.execute("/bin/cp",t,e),LaunchBar.execute("/usr/bin/open",e)},saved_searches=function(e){return log("saved_searches"),log(JSON.stringify(e)),mapSavedSearch(SETTINGS.saved_searches)},favorites=function(e){return log("saved_searches"),log(JSON.stringify(e)),mapFavorites(SETTINGS.favorites)},mapSavedSearch=function(e){var t;return function(){var n,o,r;for(r=[],n=0,o=e.length;n<o;n++)t=e[n],r.push({title:t.name,actionArgument:t.search,action:"runWithString",actionReturnsItems:!0,icon:"search.png",subtitle:t.search,alwaysShowsSubtitle:!0});return r}()},mapFavorites=function(e){var t;return function(){var n,o,r;for(r=[],n=0,o=e.length;n<o;n++)t=e[n],r.push({title:t.name,notelink:t.note_link,action:"openNote",actionReturnsItems:!0,icon:"com.evernote.Evernote"});return r}()},mapSearchResults=function(e,t){var n,o,r,a,i,c,s;for(c=[],o=0,r=e.length;o<r;o++)a=e[o],(i={}).title=a.title,i.label=a.notebook,i.date=a.date,n=new Date(a.date),s=LaunchBar.formatDate(n,{relativeDateFormatting:!0,timeStyle:"short",dateStyle:"medium"}),i.subtitle=a.tags&&Object.keys(a.tags).length>0?s+" - "+a.tags:""+s,i.action="handleSearchResult",i.alwaysShowsSubtitle=!0,i.icon="com.evernote.Evernote",i.notelink=a.notelink,i.query=t,c.push(i);return c.sort(function(e,t){var n,o;return n=new Date(e.date),o=new Date(t.date),n<o?1:n>o?-1:0}),c},loadSettings=function(e){var t;return(t=function(){try{return File.readJSON(e)}catch(e){return{}}}()).debug||(t.debug=!1),t.saved_searches||(t.saved_searches=[]),t.favorites||(t.favorites=[]),t.max_results||(t.max_results=20),t.query_min_len||(t.query_min_len=3),t},log=function(e){if(SETTINGS.debug)return LaunchBar.log(e)},Evernote=function(){function Evernote(){}return Evernote.open=function(){return log("@open"),LaunchBar.executeAppleScript('tell application "LaunchBar" to hide\nif application "Evernote" is running then\n  tell application "Evernote"\n    open collection window\n    activate\n  end tell\nelse\n  tell application "Evernote"\n    activate\n  end tell\nend if'),log("@open: done")},Evernote.search=function(e,t,n){var o;return log("@search: '"+e+", "+t+", "+n+"'"),o=Evernote._evernote_search(e,t,n),log("search result: '"+JSON.stringify(o)+"'"),log("@search: done"),o},Evernote._evernote_search=function(query,maxResults,debug){var notes;return notes=LaunchBar.executeAppleScriptFile(Action.path+"/Contents/Scripts/findNotes.applescript",query,maxResults,debug).replace(/@@\\@@/g,"\\'"),notes.length>0?eval(notes):[]},Evernote.open_note=function(e){return log("@_open_note: '"+JSON.stringify(e)+"'"),LaunchBar.executeAppleScript('tell application "LaunchBar" to hide\ntell application "Evernote"\n  set theNote to find note "'+e.notelink+'"\n  open note window with theNote\n  activate\nend tell'),log("@_open_note: done")},Evernote.open_search_window=function(e){return log("@open_search_window: '"+e+"'"),LaunchBar.executeAppleScript('tell application "LaunchBar" to hide\ntell application "Evernote"\n  set _window to open collection window with query string "'+e+'"\n  -- the next line is necessary to populate the search query field\n  set (query string of _window) to "'+e+'"\n  activate\nend tell'),log("@open_search_window: done")},Evernote.copy_note_link=function(e){return log("@_copy_note_link: '"+JSON.stringify(e)+"'"),LaunchBar.executeAppleScript('tell application "LaunchBar" to hide\nset the clipboard to "'+e.notelink+'"'),log("@_copy_note_link: done")},Evernote.createNote=function(){return log("createNote"),LaunchBar.executeAppleScript('tell application "LaunchBar" to hide\ntell application "Evernote"\n  set theNote to create note with text " "\n  open note window with theNote\n  activate\nend tell'),log("createNote: done")},Evernote.syncNow=function(){return log("syncNow"),LaunchBar.executeAppleScript('tell application "LaunchBar" to hide\ntell application "Evernote"\n  synchronize\nend tell'),log("syncNow: done")},Evernote}(),(init=function(){return LaunchBar&&LaunchBar.systemVersion?SETTINGS_FILE=Action.path+"/Contents/Scripts/settings.js":module.exports={Evernote:Evernote,run:run,runWithString:runWithString,loadSettings:loadSettings,mapSavedSearch:mapSavedSearch,mapFavorites:mapFavorites,mapSearchResults:mapSearchResults,handleSearchResult:handleSearchResult,openNote:openNote,createNote:createNote,syncNow:syncNow},SETTINGS=loadSettings(SETTINGS_FILE)})();